hydra:
  run:
    dir: .
  output_subdir: null
  job:
    chdir: false
model:
  vocab_size: 32000
  dim: 384
  num_layers: 8
  heads: 6
  teach_scale: 0.1
  teach_clip: 5.0
  self_mod_lr: 0.001
  teach_schedule:
    warmup_steps: 2000
    decay_start: 120000
    decay_duration: 20000
  titan_level:
    name: titan
    update_period: 8
    optimizer_key: titan_opt
  cms_levels:
  - name: cms_fast
    update_period: 8
    optimizer_key: cms_opt
  - name: cms_mid
    update_period: 32
    optimizer_key: cms_opt
  - name: cms_slow
    update_period: 128
    optimizer_key: cms_opt
  - name: cms_ultra
    update_period: 512
    optimizer_key: cms_opt
  optimizers:
    titan_opt:
      type: deep_momentum
      lr: 0.0006
      params:
        beta: 0.9
        beta2: 0.999
    cms_opt:
      type: deep_momentum
      lr: 0.0003
      params:
        beta: 0.9
        beta2: 0.999
  cms_hidden_multiplier: 2
data:
  source: mixture
  seq_len: 1024
  batch_size: 2
  num_workers: 2
  mixture:
    samples_per_epoch: 65536
    seed: 1337
    sources:
    - name: refinedweb
      shards_dir: data/shards/refinedweb_filtered
      weight: 0.4
    - name: wikipedia
      shards_dir: data/shards/wikipedia_filtered
      weight: 0.2
    - name: c4
      shards_dir: data/shards/c4_filtered
      weight: 0.15
    - name: redpajama
      shards_dir: data/shards/redpajama_filtered
      weight: 0.15
    - name: code
      shards_dir: data/shards/code_filtered
      weight: 0.1
train:
  online_updates: true
  online_chunk_size: 0
  per_layer_teach_signal: true
  steps: 5000
  log_interval: 25
  device: cuda:1
  seed: 1337
  deterministic: false
  mixed_precision:
    enabled: true
    dtype: bf16
  compile:
    enable: false
    mode: max-autotune
  checkpoint:
    enable: true
    dir: artifacts/checkpoints/pilot_cms_sparse
    save_interval: 1000
    save_last: true
    resume_path: null
    resume_tag: null
optim:
  type: adamw
  lr: 0.00025
  fused: auto
logging:
  enabled: true
  backend: json
  path: logs/pilot_cms_sparse_metrics.json
  project: nested-learning
  run_name: pilot-cms-sparse
